# Test Results Aggregator

A Python module for aggregating, analyzing, and visualizing Keycloak benchmark test results. This module processes raw test result data from multiple benchmark runs and generates comprehensive statistics and reports.

## Overview

The Test Results Aggregator processes JSON result files generated by the Keycloak Benchmark tool, performs statistical analysis, and outputs aggregated reports in both JSON and HTML formats. It's designed to handle multiple test instances and provide a consolidated view of performance metrics.

## Architecture

```
                                                  +-------------------+
                                                  |                   |
                          +-------------------+   |  HTML Reports     |
                          |                   |   |  (visualization)  |
                          |  Result Files     |   |                   |
                          |  (JSON)           |   +-------------------+
                          |                   |             ^
                          +--------+----------+             |
                                   |                        |
                                   v                        |
+---------------+        +-------------------+     +--------+----------+
|               |        |                   |     |                   |
| Command Line  +------->+  ResultsAggregator+---->+  Reporters       |
| Interface     |        |  (Core Engine)    |     |  (Output)        |
|               |        |                   |     |                   |
+---------------+        +-------------------+     +--------+----------+
                                   ^                        |
                                   |                        |
                          +--------+----------+             |
                          |                   |             v
                          |  Data Models      |    +-------------------+
                          |  (Parsing)        |    |                   |
                          |                   |    |  JSON Summary     |
                          +-------------------+    |  (Data)           |
                                                  |                   |
                                                  +-------------------+
```

## Components

| Module | Description |
|--------|-------------|
| `models.py` | Data models and structures for representing benchmark statistics and test results. Handles parsing of JSON result files. |
| `aggregator.py` | Core aggregation engine that finds relevant files, computes statistics, and manages the overall aggregation process. |
| `reporters.py` | Output generators for various report formats (JSON, HTML, JavaScript). |
| `utils.py` | Utility functions for file operations, data formatting, and other helper tasks. |
| `main.py` | Command-line interface implementation and entry point for the module. |
| `run.py` | Lightweight entry script for executing the module as a standalone tool. |
| `__init__.py` | Package initialization, metadata, and exports. |

## Key Classes

### `TestResult` (models.py)
Represents a single test result, with methods to parse JSON files and extract relevant metrics.

### `BenchmarkStat` (models.py)
Statistical container for performance metrics like response times, throughput, and percentiles.

### `ResultsAggregator` (aggregator.py)
The core engine that discovers test result files, aggregates statistics, and provides analysis methods.

### `JsonReporter`, `HtmlReporter`, `JavaScriptReporter` (reporters.py)
Report generators for different output formats.

## Workflow

1. **Discovery**: Find relevant test result files matching the specified scenario
2. **Parsing**: Read and parse JSON result files into TestResult objects
3. **Aggregation**: Combine metrics from multiple test results
4. **Statistical Analysis**: Calculate averages, percentiles, and other statistics
5. **Reporting**: Generate output reports in requested formats

## Usage

The module can be used in two ways:

### 1. As a command-line tool:

```bash
python -m test_results_aggregator.run <scenario> [options]
```

Where `<scenario>` is the suffix of the Keycloak benchmark test scenario name. The aggregator extracts this from the result directory names, which match the scenario name used during testing.

For example, if you ran tests with the scenario `keycloak.scenario.authentication.AuthorizationCode`, you would use:
```bash
python -m test_results_aggregator.run authorizationcode
```

The available Keycloak test scenarios can be found in the [Keycloak Benchmark documentation](https://www.keycloak.org/keycloak-benchmark/benchmark-guide/latest/scenario-overview). The aggregator uses the last segment of the full scenario path (converted to lowercase) as the identifier.

Common scenario suffixes include:
- `authorizationcode` - OAuth2 Authorization Code flow
- `loginuserpassword` - Browser login flow
- `clientsecret` - Client Credentials Grant
- `createrealms` - Create realms admin operation

### 2. As a Python library:

```python
from test_results_aggregator.aggregator import ResultsAggregator
from test_results_aggregator.reporters import JsonReporter

# Create aggregator
aggregator = ResultsAggregator("authorizationcode", "./results")

# Process results
aggregator.find_result_files()
aggregator.aggregate_results()

# Output report
reporter = JsonReporter(aggregator)
reporter.export_json_summary("result_summary.json")
```

## Output Formats

1. **Console Output**: Text-based summary of aggregated results
2. **JSON Summary**: Structured data ideal for programmatic processing
3. **HTML Report**: Interactive dashboard with charts and detailed metrics
4. **JavaScript Data**: Exportable data for custom visualizations 